# 智慧购房决策工具 - 设计文档

> 日期：2026-02-24
> 状态：已确认

---

## 1. 项目概述

一个面向小范围分享的购房决策 Web 工具，支持输入城市、区域、价格范围，自动抓取房产数据并基于加权评分模型推荐小区，同时展示各小区的优缺点分析。

### 目标用户
小范围分享（朋友/同事），不需要账号体系。

### 初始支持城市
上海、苏州

### MVP 范围
- 房价查询与对比
- 周边配套（地铁、医院、商场、公园）
- 学区信息（对口小学/初中）
- 物业公司评级
- 开发商信誉
- 综合评分排名 + 优缺点分析

**暂不实现**：社交网络/邻居素质维度（数据获取困难，后续迭代）

---

## 2. 技术选型

| 层级 | 技术 | 理由 |
|------|------|------|
| 后端 | Python 3.11+ / FastAPI | 轻量、异步性能好、爬虫生态丰富 |
| 前端 | React + Ant Design | 快速搭建 UI，组件丰富 |
| 爬虫 | httpx + parsel | 轻量级，满足 MVP 需求 |
| 数据库 | SQLite（MVP） | 零配置轻量，后续可迁移 PostgreSQL |
| POI 数据 | 高德地图 Web API | 月 900 万次免费配额 |

---

## 3. 系统架构

```
┌───────────────────────────────────────────���─────────┐
│                   React 前端 (SPA)                   │
│  搜索条件输入 → 小区列表/排名 → 小区详情/优缺点分析     │
└──────────────────────┬──────────────────────────────┘
                       │ REST API
┌──────────────────────▼──────────────────────────────┐
│              Python FastAPI 后端                      │
│                                                      │
│  ┌──────────┐  ┌──────────┐  ┌───────────────────┐  │
│  │ 搜索服务  │  │ 评分引擎  │  │ 优缺点分析引擎    │  │
│  └──────────┘  └──────────┘  └───────────────────┘  │
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │            数据聚合层 (Data Aggregator)        │   │
│  └──────────────────────────────────────────────┘   │
└──────────────────────┬──────────────────────────────┘
                       │
        ┌──────────────┼──────────────┐
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐ ┌──────────────┐
│ 爬虫模块      │ │ 高德 API │ │ 本地数据库    │
│ (httpx+      │ │ (POI     │ │ (SQLite)     │
│  parsel)     │ │  搜索)   │ │              │
│              │ │          │ │ • 学区对口表  │
│ • 贝壳找房   │ │ • 周边学校│ │ • 物业百强    │
│ • 安��客     │ │ • 医院    │ │ • 开发商评级  │
│ • 房天下     │ │ • 商场    │ │ • 爬取缓存    │
└──────────────┘ └──────────┘ └──────────────┘
```

---

## 4. 数据模型

### Community（小区）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| name | str | 小区名称 |
| city | str | 城市（上海/苏州） |
| district | str | 区（浦东、姑苏等） |
| address | str | 详细地址 |
| lat / lng | float | 经纬度 |
| avg_price | int | 均价（元/㎡） |
| price_trend | json | 近6月价格走势 |
| build_year | int | 建成年份 |
| total_units | int | 总户数 |
| green_ratio | float | 绿化率 |
| volume_ratio | float | 容积率 |
| property_company | str | 物业公司 |
| property_fee | float | 物业费（元/㎡/月） |
| developer | str | 开发商 |
| parking_ratio | str | 车位比 |
| updated_at | datetime | 数据更新时间 |

### SchoolDistrict（学区信息）

| 字段 | 类型 | 说明 |
|------|------|------|
| community_id | FK | 关联小区 |
| primary_school | str | 对口小学 |
| middle_school | str | 对口初中 |
| school_rank | str | 学校等级（市重点/区重点/普通） |
| year | int | 对口年份 |

### NearbyPOI（周边配套）

| 字段 | 类型 | 说明 |
|------|------|------|
| community_id | FK | 关联小区 |
| category | str | 分类（地铁/医院/商场/公园/学校） |
| name | str | 名称 |
| distance | int | 距离（米） |
| walk_time | int | 步行时间（分钟） |

---

## 5. 评分体系

### 加权评分模型（用户可调权重）

| 维度 | 默认权重 | 评分规则 |
|------|---------|---------|
| 性价比 | 30% | 均价在预算范围内的匹配度 + 价格趋势 |
| 学区质量 | 25% | 市重点10分、区重点7分、普通5分、无对口0分 |
| 周边配套 | 20% | 1km内地铁站/医院/商场/公���的加权距离得分 |
| 物业品质 | 15% | 物业百强匹配、物业费合理性、绿化率/容积率 |
| 开发商信誉 | 10% | TOP10/TOP50/普通/小开发商分级 |

**总分 = Σ(维度得分 × 权重)**，满分 100 分

### 优缺点自动生成

- **优点**：得分 ≥ 8 的维度
- **缺点**：得分 ≤ 4 的维度
- **中性**：介于中间的维度

---

## 6. 数据获取策略

### 爬虫数据源

| 平台 | 数据内容 | 优先级 |
|------|---------|-------|
| 贝壳找房 | 小区均价、建筑信息、物业、开发商 | P0 |
| 安居客 | 小区数据补充 | P1 (fallback) |
| 房天下 | 兜底数据源 | P2 (fallback) |

### 爬虫策略

- **触发方式**：用户搜索时按需触发 + 后台定时任务（每周）
- **缓存策略**：数据缓存 7 天，7 天内相同查询直接返回缓存
- **反爬应对**：请求间隔随机 2-5 秒、UA 轮换、代理池（可选）
- **数据源优先级**：贝壳 → 安居客 → 房天下（fallback 链）

### 其他数据源

- **高德地图 API**：周边 POI 搜索（免费配额）
- **学区数据**：手动维护 JSON 文件，来源政府官网/本地宝，每年更新
- **物业/开发商评级**：手动维护 JSON 文件，来源年度百强排名

---

## 7. API 设计

```
POST /api/v1/search              # 搜索推荐小区
  Body: { city, district?, price_min, price_max, weights? }
  Response: { communities: [{ name, score, sub_scores, pros, cons, ... }] }

GET  /api/v1/community/{id}      # 小区详情
  Response: { 完整数据 + 优缺点 + 周边POI + 学区信息 }

GET  /api/v1/community/{id}/pois # 小区周边POI
  Response: { pois: [{ category, name, distance, ... }] }

POST /api/v1/crawl/trigger       # 手动触发数据采集（管理接口）
  Body: { city, district? }

GET  /api/v1/config/weights      # 获取默认权重配置
PUT  /api/v1/config/weights      # 更新权重配置
```

---

## 8. 前端页面

### 搜索页
顶部搜索栏（城市/区/价格范围），下方可展开"高级设置"调权重滑块。

### 结果页
小区卡片列表，每张卡片显示：
- 小区名 + 综合评分（大数字）
- 各维度小分条形图
- 标签：如「市重点学区」「地铁旁」
- 核心优缺点（各 1-2 条）

### 详情页
- 顶部：小区基本信息 + 综合评分雷达图
- 中部：优缺点详细分析
- 底部：周边配套地图（高德地图嵌入）+ 学区信息

---

## 9. 项目目录结构

```
smart-housing-decision/
├── backend/
│   ├── app/
│   │   ├── main.py
│   │   ├── api/
│   │   │   ├── search.py
│   │   │   ├── community.py
│   │   │   └── admin.py
│   │   ├── core/
│   │   │   ├── scoring.py
│   │   │   ├── analyzer.py
│   │   │   └── aggregator.py
│   │   ├── crawler/
│   │   │   ├── beike.py
│   │   │   ├── anjuke.py
│   │   │   └── base.py
│   │   ├── services/
│   │   │   └── amap.py
│   │   ├── models/
│   │   ├── schemas/
│   │   └── config.py
│   ├── data/
│   │   ├── school_districts/
│   │   ├── property_ranks.json
│   │   └── developer_ranks.json
│   ├── requirements.txt
│   └── Dockerfile
├── frontend/
│   ├── src/
│   │   ├── pages/
│   │   │   ├── SearchPage.tsx
│   │   │   ├── ResultPage.tsx
│   │   │   └── DetailPage.tsx
│   │   ├── components/
│   │   │   ├── SearchForm.tsx
│   │   │   ├── CommunityCard.tsx
│   │   │   ├── ScoreRadar.tsx
│   │   │   ├── ProsCons.tsx
│   │   │   └── WeightSlider.tsx
│   │   ├── api/
│   │   └── App.tsx
│   └── package.json
├── docker-compose.yml
├── docs/plans/
└── LICENSE
```

---

## 10. 后续迭代方向

1. **邻居素质维度**：爬取社区评价 + NLP 情感分析
2. **更多城市支持**：通用化爬虫适配
3. **数据源升级**：接入云房数据 API 替代爬虫
4. **AI 分析**：LLM 对 Top N 结果做深度分析推荐
5. **移动端适配**：响应式设计或小程序
